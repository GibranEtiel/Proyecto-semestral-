<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zapatillas</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">Tienda de Zapatillas</a>
        <button class="btn btn-outline-success my-2 my-sm-0" id="carritoIcono" data-toggle="modal" data-target="#carritoModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                <path d="M0 1a1 1 0 0 1 1-1h1.48a1 1 0 0 1 .977.783L3.89 3H14a1 1 0 0 1 .979 1.2l-1.482 7.36a2 2 0 0 1-1.97 1.44H4.361l-.2-1H12.8a1 1 0 0 0 .98-1.2L14.5 4H3.78l-.8 4H1a1 1 0 0 1-1-1V1zM4.334 11l.8-4H13.5l1.1 5.44a1 1 0 0 1-.98 1.2H4.78l-.445-2h-.003zM4 12a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm0 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm8-1a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm0 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
            </svg>
            <span class="badge badge-pill badge-danger" id="carritoCantidad">0</span>
        </button>
    </nav>
    
    <div class="container mt-5" id="zapatillas-container"></div>

    <!-- Modal -->
    <div class="modal fade" id="zapatillaModal" tabindex="-1" role="dialog" aria-labelledby="zapatillaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="zapatillaModalLabel">Zapatilla</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="zapatillaDetalle"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="agregarAlCarritoBtn">Agregar al Carrito</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Carrito Modal -->
    <div class="modal fade" id="carritoModal" tabindex="-1" role="dialog" aria-labelledby="carritoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="carritoModalLabel">Carrito de Compras</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Precio</th>
                                <th>Cantidad</th>
                                <th>Subtotal</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="carrito-body"></tbody>
                    </table>
                    <h3>Total: $<span id="total-carrito">0</span></h3>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert -->
    <div class="alert alert-success alert-dismissible fade show" role="alert" id="alert-carrito" style="display: none;">
        AÃ±adido al carrito
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const url = 'https://my.api.mockaroo.com/users.json?key=c1675480';
            let carrito = [];

            fetch(url)
            .then(response => response.json())
            .then(data => {
                const zapatillasContainer = document.getElementById('zapatillas-container');
                const zapatillasHombre = data.filter(zapatilla => zapatilla.tipo === 'hombre');
                
                for (let i = 0; i < zapatillasHombre.length; i += 4) {
                    const zapatillasGroup = zapatillasHombre.slice(i, i + 4);
                    const row = document.createElement('div');
                    row.classList.add('row', 'mt-4');

                    zapatillasGroup.forEach(zapatilla => {
                        const col = document.createElement('div');
                        col.classList.add('col-md-3');

                        const card = document.createElement('div');
                        card.classList.add('card', 'mb-4', 'shadow-sm');
                        card.setAttribute('data-toggle', 'modal');
                        card.setAttribute('data-target', '#zapatillaModal');
                        card.setAttribute('data-zapatilla-id', zapatilla.id);

                        const img = document.createElement('img');
                        img.classList.add('card-img-top');
                        img.src = zapatilla.imagen;
                        img.alt = zapatilla.nombre;

                        const cardBody = document.createElement('div');
                        cardBody.classList.add('card-body');

                        const cardTitle = document.createElement('h5');
                        cardTitle.classList.add('card-title');
                        cardTitle.textContent = zapatilla.nombre;

                        const cardText = document.createElement('p');
                        cardText.classList.add('card-text');
                        cardText.innerHTML = `<b><br>Tipo: ${zapatilla.tipo}<br><b>Precio:</b> $${zapatilla.precio}`;

                        cardBody.appendChild(cardTitle);
                        cardBody.appendChild(cardText);

                        card.appendChild(img);
                        card.appendChild(cardBody);

                        col.appendChild(card);
                        row.appendChild(col);
                    });

                    zapatillasContainer.appendChild(row);
                }

                document.querySelectorAll('.card').forEach(card => {
                    card.addEventListener('click', () => {
                        const zapatillaId = card.getAttribute('data-zapatilla-id');
                        const zapatilla = zapatillasHombre.find(zapatilla => zapatilla.id === parseInt(zapatillaId));
                        mostrarDetallesZapatilla(zapatilla);
                    });
                });
            })
            .catch(error => console.log(error));

            function mostrarDetallesZapatilla(zapatilla) {
                const modalTitle = document.getElementById('zapatillaModalLabel');
                const modalBody = document.getElementById('zapatillaDetalle');
                modalTitle.textContent = zapatilla.nombre;
                modalBody.innerHTML = `
                    <img src="${zapatilla.imagen}" class="img-fluid mb-2" alt="${zapatilla.nombre}">
                    <p><b>Descripcion:</b> ${zapatilla.descripcion}</p>
                    <p>Tipo: ${zapatilla.tipo}</p>
                    <p>Precio: $${zapatilla.precio}</p>
                `;
                const agregarAlCarritoBtn = document.getElementById('agregarAlCarritoBtn');
                agregarAlCarritoBtn.onclick = () => {
                    agregarAlCarrito(zapatilla);
                    $('#zapatillaModal').modal('hide');
                };
            }

            function agregarAlCarrito(zapatilla) {
                const itemExistente = carrito.find(item => item.id === zapatilla.id);
                if (itemExistente) {
                    itemExistente.cantidad++;
                } else {
                    carrito.push({...zapatilla, cantidad: 1});
                }
                mostrarAlerta();
                actualizarCarrito();
            }

            function eliminarDelCarrito(id) {
                carrito = carrito.filter(item => item.id !== id);
                actualizarCarrito();
            }

            function cambiarCantidad(id, cantidad) {
                const item = carrito.find(item => item.id === id);
                if (item) {
                    item.cantidad = cantidad;
                    actualizarCarrito();
                }
            }

            function actualizarCarrito() {
                const carritoBody = document.getElementById('carrito-body');
                carritoBody.innerHTML = '';
                let total = 0;
                
                carrito.forEach(item => {
                    const row = document.createElement('tr');

                    const nombre = document.createElement('td');
                    nombre.textContent = item.nombre;

                    const precio = document.createElement('td');
                    precio.textContent = item.precio;

                    const cantidad = document.createElement('td');
                    const inputCantidad = document.createElement('input');
                    inputCantidad.type = 'number';
                    inputCantidad.value = item.cantidad;
                    inputCantidad.min = 1;
                    inputCantidad.classList.add('form-control');
                    inputCantidad.addEventListener('change', () => cambiarCantidad(item.id, parseInt(inputCantidad.value)));
                    cantidad.appendChild(inputCantidad);

                    const subtotal = document.createElement('td');
                    subtotal.textContent = item.precio * item.cantidad;

                    const acciones = document.createElement('td');
                    const eliminarBtn = document.createElement('button');
                    eliminarBtn.classList.add('btn', 'btn-danger');
                    eliminarBtn.textContent = 'Eliminar';
                    eliminarBtn.addEventListener('click', () => eliminarDelCarrito(item.id));
                    acciones.appendChild(eliminarBtn);

                    row.appendChild(nombre);
                    row.appendChild(precio);
                    row.appendChild(cantidad);
                    row.appendChild(subtotal);
                    row.appendChild(acciones);

                    carritoBody.appendChild(row);

                    total += item.precio * item.cantidad;
                });

                document.getElementById('total-carrito').textContent = total;
                document.getElementById('carritoCantidad').textContent = carrito.length;
            }

            function mostrarAlerta() {
                const alertCarrito = document.getElementById('alert-carrito');
                alertCarrito.style.display = 'block';
                setTimeout(() => {
                    alertCarrito.style.display = 'none';
                }, 3000);
            }
        });
    </script>
</body>
</html>
